<div class="d-flex justify-content-between">
    <h3>ARTICLE</h3>
    <button
        class="btn text-danger fs-5"
        *ngIf="mode == 'edit'"
        (click)="toAddModeEvent.emit()"
    >
        <i class="bi bi-x-lg"></i>
    </button>
</div>
<form [formGroup]="form" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
    <div class="row">
        <div class="col-8">
            <table class="table">
                <tr>
                    <td><label for="libelle">Libellé</label></td>
                    <td class="d-flex flex-column">
                        <input
                            type="text"
                            class="form-control"
                            name="libelle"
                            formControlName="libelle"
                            (input)="updateRef()"
                            (input)="check()"
                        />
                        <small
                            class="text-danger mt-1 p-0 w-auto"
                            style="font-size: 70%"
                            >{{
                                libelleExists
                                    ? "Ce libellé appartient à un autre article"
                                    : ""
                            }}
                        </small>
                    </td>
                </tr>
                <tr>
                    <td><label for="prix">Prix</label></td>
                    <td>
                        <input
                            type="number"
                            min="0"
                            class="form-control"
                            name="prix"
                            formControlName="prix"
                            (input)="check()"
                        />
                    </td>
                </tr>
                <tr>
                    <td><label for="stock">Stock</label></td>
                    <td>
                        <input
                            type="number"
                            min="0"
                            class="form-control"
                            name="stock"
                            formControlName="stock"
                            (input)="check()"
                        />
                    </td>
                </tr>
                <tr>
                    <td><label for="categories">Catégorie</label></td>
                    <td>
                        <select
                            *ngIf="data?.categories"
                            class="form-select"
                            formControlName="category"
                            (change)="updateRef()"
                            (change)="check()"
                            [compareWith]="compareCat"
                        >
                            <option value="">Choisir</option>
                            <option
                                [ngValue]="c"
                                *ngFor="let c of data.categories"
                            >
                                {{ c.libelle }}
                            </option>
                        </select>
                    </td>
                </tr>
                <tr class="position-relative">
                    <td><label for="fournisseurs">Fournisseur</label></td>
                    <td>
                        <div class="border border-1 rounded">
                            <app-selected-item
                                *ngFor="
                                    let f of form.get('fournisseurs')?.value
                                "
                                [data]="f"
                                (itemDeleted)="onDeleteFournisseur($event)"
                            ></app-selected-item>
                            <input
                                style="border: none"
                                type="text"
                                name="fournisseurs"
                                class="form-control shadow-none p-0"
                                (input)="onFournisseurInput($event)"
                                #fournInput
                            />
                        </div>
                        <app-suggestions
                            *ngIf="fournItems"
                            [items]="fournItems"
                            (itemClicked)="onAddFournisseur($event, fournInput)"
                        ></app-suggestions>
                    </td>
                </tr>
            </table>
        </div>
        <div class="col-4 d-flex flex-column justify-content-between">
            <div class="d-flex align-items-center flex-column">
                <label
                    for="photo"
                    class="form-label text-center"
                    style="font-size: 150%; cursor: pointer"
                    >{{ form.get("photo")?.value ? "" : "Choisir une photo" }}
                    <img
                        *ngIf="form.get('photo')?.value"
                        width="150px"
                        height="150px"
                        [src]="form.get('photo')?.value"
                        #photoContainer
                /></label>
                <input
                    class="form-control d-none"
                    type="file"
                    id="photo"
                    accept="image/*"
                    (change)="onPhotoPicked($event)"
                />
            </div>
            <input
                type="text"
                name="ref"
                class="text-center form-control"
                formControlName="ref"
                readonly
            />
        </div>

        <div class="d-flex justify-content-between">
            <div></div>
            <div class="p-3">
                <button
                    class="btn btn-primary"
                    type="submit"
                    [disabled]="submitBtnDisabled"
                >
                    {{ mode === "edit" ? "Éditer" : "Enregistrer" }}
                </button>
            </div>
        </div>
    </div>
</form>
